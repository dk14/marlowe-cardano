testName: WolframBet

operations:

- Comment: Create the wallet for the buyer, fund it with 80 ADA, and activate the Marlowe endpoints.

- CreateWallet:
    nickname: AliceWallet
    utxo: 80000000

- Comment: Create the wallet for the seller, fund it with 15 ADA, and activate the Marlowe endpoints.

- CreateWallet:
    nickname: BobWallet
    utxo: 15000000

- Comment: Create the wallet for the mediator, fund it with 20 ADA, and activate the Marlowe endpoints.

- CreateWallet:
    nickname: Mediator
    utxo: 20000000

- Comment: The mediator mints role tokens and distributes them across wallets.

- Mint:
    issuer: Mediator
    nickname: RoleTokenCurrency
    minLovelace: 2000000
    tokenDistribution:
      - [AliceWallet, SellerRoleToken, 1]
      - [BobWallet, BuyerRoleToken, 1]
      - [Mediator, MediatorRoleToken, 1]

- Comment: The mediator creates the escrow contract, which was downloaded from Marlowe Playground. The purchase price is 50 ADA.

- Initialize:
    submitter: Mediator
    roleCurrency: RoleTokenCurrency
    minLovelace: 2000000
    source:
      timeout: 21686350063495
      timeout_continuation: close
      when:
      - case:
          deposits: 1000
          into_account:
            role_token: Alice
          of_token:
            currency_symbol: ''
            token_name: ''
          party:
            role_token: Alice
        then:
          timeout: 216863500634957
          timeout_continuation: close
          when:
          - case:
              deposits: 1000
              into_account:
                role_token: Bob
              of_token:
                currency_symbol: ''
                token_name: ''
              party:
                role_token: Bob
            then:
              timeout: 431686350279989
              timeout_continuation: close
              when:
              - case:
                  choose_between:
                  - from: 0
                    to: 100000000
                  for_choice:
                    choice_name: WOLF_BTCUSD
                    choice_owner:
                      address: addr_test1vrxx3rjangevudlrejgp9m508uc26jd02n7lmdz365n4wrca35y5j
                then:
                  else:
                    from_account:
                      role_token: Bob
                    pay: 1000
                    then: close
                    to:
                      party:
                        role_token: Alice
                    token:
                      currency_symbol: ''
                      token_name: ''
                  if:
                    lt: 1000000
                    value:
                      value_of_choice:
                        choice_name: WOLF_BTCUSD
                        choice_owner:
                          address: addr_test1vrxx3rjangevudlrejgp9m508uc26jd02n7lmdz365n4wrca35y5j
                  then:
                    from_account:
                      role_token: Alice
                    pay: 1000
                    then: close
                    to:
                      party:
                        role_token: Bob
                    token:
                      currency_symbol: ''
                      token_name: ''

- AutoRun

- Comment: The mediator should have 14 ADA now, since 2 ADA was sent to the script address when creating the contract and 2 ADA each was sent to the buyer and seller along with their role tokens (we ignore a possible 1 ADA in tx fees).

- CheckBalance:
    wallet: Mediator
    balance:
      - [RoleTokenCurrency, MediatorRoleToken, 1]

- Comment: The buyer and seller should each now have an additional 2 ADA that arrived with their role token.

- CheckBalance:
    wallet: AliceWallet
    balance:
      - [ADA, 1000]
      - [RoleTokenCurrency, BuyerRoleToken, 1]

- CheckBalance:
    wallet: BobWallet
    balance:
      - [ADA, 17]
      - [RoleTokenCurrency, SellerRoleToken, 1]

- Comment: The buyer deposits the 50 ADA purchase price.

- Prepare:
    inputs:
      - input_from_party:
          role_token: Alice
        that_deposits: 1000
        of_token:
          currency_symbol: ""
          token_name: ""
        into_account:
          role_token: Alice
      - input_from_party:
          role_token: Bob
        that_deposits: 1000
        of_token:
          currency_symbol: ""
          token_name: ""
        into_account:
          role_token: Bob
    minimumTime:
      relative: -15
    maximumTime:
      relative: 120

- AutoRun

- Comment: The buyer should have about 32 ADA now, since they paid 50 ADA for the purchase (balance check ignores tx fees).

- CheckBalance:
    wallet: AliceWallet
    balance:
      - [ADA, 1000]
      - [RoleTokenCurrency, Alice, 1]

- CheckBalance:
    wallet: BobWallet
    balance:
      - [ADA, 1000]
      - [RoleTokenCurrency, Bob, 1]

- Comment: The buyer receives the purchase and reports that everything is alright.

- Prepare:
    inputs:
      - for_choice_id:
          choice_name: WOLF_BTCUSD
          choice_owner:
            address: addr_test1vrxx3rjangevudlrejgp9m508uc26jd02n7lmdz365n4wrca35y5j
        input_that_chooses_num: 0
    minimumTime:
      relative: -15
    maximumTime:
      relative: 120

- AutoRun

- Comment: The buyer should still have 32 ADA now (we ignore here possible another 2 ADA in fees).

- CheckBalance:
    wallet: AliceWallet
    balance:
      - [ADA, 0]
      - [RoleTokenCurrency, Alice, 1]

- Comment: Now the seller redeems the 50 ADA from the payout script.

- CheckBalance:
    wallet: BobWallet
    balance:
      - [ADA, 2000]
      - [RoleTokenCurrency, Alice, 1]



